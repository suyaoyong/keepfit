<view class="page">
  <view class="header">
    <view class="title">{{bookTitle || '阅读'}}</view>
    <view class="subtitle">{{chapterTitle || ('第' + chapterNo + '章')}}</view>
  </view>

  <view class="card empty" wx:if="{{loading}}">
    <view class="empty-text">正在加载章节...</view>
  </view>

  <view class="card empty" wx:elif="{{errorMessage}}">
    <view class="empty-text">{{errorMessage}}</view>
    <button class="secondary-button" bindtap="loadChapter">重试</button>
  </view>

  <scroll-view wx:else class="reader-scroll" scroll-y="true" scroll-top="{{scrollTopView}}" bindscroll="onReaderScroll">
    <view class="reader-card">
      <block wx:for="{{contentBlocks}}" wx:key="index">
        <view wx:if="{{item.type === 'text'}}" class="reader-block-text">
          <rich-text nodes="{{item.html}}"></rich-text>
        </view>
        <view wx:elif="{{item.type === 'image'}}" class="reader-block-image">
          <image class="reader-image" src="{{item.src}}" mode="widthFix" data-src="{{item.src}}" bindtap="onPreviewImage" />
          <view class="reader-image-tip">点击图片可放大预览</view>
        </view>
      </block>
    </view>
  </scroll-view>

  <view class="reader-actions">
    <button class="secondary-button" bindtap="onPrevChapter" disabled="{{prevDisabled}}">{{prevLabel}}</button>
    <button class="secondary-button" bindtap="onNextChapter" disabled="{{nextDisabled}}">{{nextLabel}}</button>
  </view>
</view>
